import ollama
import re


def get_content(content, content_type):
    client = ollama.Client()
    model = "media_summarizer1.2"

    MAX_CHARACTERS = "63206" # Facebook: 63,206  Twitter: 280

    #main_text = "Netanyahu praises Trump's 'bold vision' for Gaza at Rubio meeting 5 hours ago Ian Aikman & Maia Davies BBC News Reuters The US secretary of state met the Israeli prime minister in Jerusalem on Sunday Israel's prime minister has said he is working to make US President Donald Trump's plan to remove and resettle Gaza's population |a reality|. Benjamin Netanyahu said he was cooperating with the US on a |common strategy| for Gaza after a meeting with US Secretary of State Marco Rubio in Jerusalem on Sunday. He said he and Rubio had discussed ways to implement Trump's vision, which would also see the US take control of Gaza . Rubio said the plan may have |shocked and surprised| people, but that it took courage for Trump to propose an alternative to |tired ideas| of the past. Trump's mixed messaging on foreign policy leaves world guessing 'We are tired of war': Israelis and Gazans fear ceasefire collapse How 15 months of war has devastated Gaza Rubio is visiting Israel on his first tour of the Middle East as the US's top diplomat. He is also due to meet Russian officials in Saudi Arabia in coming days for potential peace talks on the war in Ukraine - a meeting that neither Ukraine nor other European countries have been invited to. Speaking at a joint news conference on Sunday, Rubio and Netanyahu outlined areas of agreement, including a desire to eradicate Hamas's governing capacity, prevent Iran from gaining a nuclear weapon, and to monitor developments in a post-Assad Syria. Netanyahu also condemned what he called |lawfare| from the International Criminal Court (ICC), which he said |outrageously libelled| Israel. He thanked the US administration for issuing sanctions against the ICC , which last year issued an arrest warrant for Netanyahu and his former defence minister over alleged war crimes in Gaza - which Israel denies - as well as a top Hamas commander. The US and Israel had a common position on Gaza, Netanyahu said, as he warned that the |gates of hell| would be opened if all Israeli hostages were not released. |Hamas can not continue as a military or government force,| Rubio added. |And as long as it stands as a force that can govern or administer or a force that can threaten by use of violence, peace becomes impossible.| Rubio's visit comes after a shipment of American-made heavy bombs arrived in Israel overnight. Israel's Defence Minister Israel Katz said his country had received a delivery of MK-84 bombs from the US late on Saturday, after Trump overturned a block on exporting the munitions placed by his predecessor, Joe Biden. Biden initially shipped thousands of MK-84s to Israel after Hamas's 7 October 2023 attack, but later declined to clear the bombs for export out of concern for their impact on Gaza. The powerful 2,000-pound bombs have a wide blast radius and can rip through concrete and metal, destroying entire buildings. Katz said the shipment represented a |significant asset| for the Israel Defense Forces (IDF) and served as evidence of the |strong alliance between Israel and the United States|. Meanwhile, Hamas said an Israeli air strike had killed three police officers near Rafah in southern Gaza on Sunday, which it called a |serious violation| of the ceasefire. The ceasefire came into force on 19 January and requires a complete pause in fighting for the first 42-day phase. Israel said it had struck |several armed individuals| in southern Gaza. Fears had been high this week that the fragile ceasefire agreement could collapse after a dispute over a planned hostage release, which was nearly aborted but ultimately went ahead on Saturday . Netanyahu's office confirmed on Sunday that an Israeli negotiating team would travel to Cairo on Monday to discuss the second phase of the ceasefire. 'We followed lives of three children surviving war in Gaza. Here's what we found' Top US envoy to meet Russian officials for Ukraine peace talks Israeli hostages and Palestinian inmates freed in latest ceasefire swap Middle East Israel-Gaza war Israel Gaza Hamas Benjamin Netanyahu United States Related 'I've seen thousands of bodies' - life of boy volunteer at a Gaza hospital 6 mins ago Middle East Israeli hostages and Palestinian inmates freed in latest ceasefire swap 1 day ago Middle East Watch: Crowds gather to welcome freed Palestinians prisoners 1 day ago Middle East More 29 mins ago Watch: Trump's motorcade drives lap of Daytona 500 racetrack The president opened the Nascar season with a flyby and lap in front of the racing cars. 29 mins ago US & Canada 1 hr ago At least nine dead in US floods and heavy rain Kentucky has seen the worst effects of the rain thus far, reporting at least eight dead. 1 hr ago US & Canada 2 hrs ago Ukraine not invited to US-Russia peace talks, source tells BBC A Ukrainian government source told the BBC Kyiv would not be present at the proposed peace talks. 2 hrs ago World 8 hrs ago US government tries to rehire nuclear staff it fired days ago It is having problems contacting people who were fired in Trump's blitz to shrink the federal workforce. 8 hrs ago US & Canada 14 hrs ago Trump administration's mixed messaging on foreign policy leaves world guessing Different narratives from senior US officials on the future of Ukraine have sown confusion in Europe - but was that perhaps the point? 14 hrs ago US & Canada"
    facebook_prompt = "Summarize the following article(s) and convert it into a social media post for Facebook. Your task is to read the given article(s), extract key insights, and generate a compelling human-like social media post intended for Facebook - note, the summary is intended to help you get your key ideas out. Make the post sound like a social media post and not simply just a summary of the article(s). Keep in mind that the character limit of a Facebook post is " + MAX_CHARACTERS + " - and that is the MAX, you don't need to necessarily go to or near that limit.\nArticle: " + content
    twitter_prompt = "Summarize the following news article and convert it into a social media post for Twitter."
    instagram_prompt = "Summarize the following news article and convert it into a social media post for Instagram."
    #format = "FORMAT {{CAPTION} {POSSIBLE HASHTAGS}}, Content Type: {" + content_type + "}, Limitations {MAX_CHARACTERS:" + MAX_CHARACTERS + "}"
    #prompt = format +  "Content to summarize: {" + content + "}"

    response = client.generate(model=model, prompt=facebook_prompt, stream=False)

    #print("Response from Ollama")
    #print(response.response)
    cleaned_response = re.sub(r'<think>.*?</think>', '', response.response, flags=re.DOTALL).strip()
    return cleaned_response

# https://www.youtube.com/watch?v=UtSSMs6ObqY&ab_channel=TechWithTim
# ollama create media_summarizer~~ -f ./Modelfile
